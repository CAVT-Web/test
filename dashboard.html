<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>ğŸ“‹ ØµÙØ­Ø© Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body { font-family: 'Segoe UI'; direction: rtl; background-color: #fafafa; padding: 20px; }

    #navbar {
      background:#007bff; padding:10px; color:white;
      display:flex; justify-content:space-between; align-items:center;
      margin-bottom:20px;
    }
    #navbar a { color:white; margin-right:15px; text-decoration:none; }
    #navbar a:hover { text-decoration: underline; }
    #navbar div:last-child { font-weight:bold; }

    .search-box { display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; }
    input, button { padding: 8px; font-size: 14px; border: 1px solid #ccc; border-radius: 5px; }
    button { cursor: pointer; background-color: #007bff; color: white; font-weight: bold; }

    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 10px; text-align: center; }
    th { background-color: #007bff; color: white; }
    tr:nth-child(even) { background-color: #f2f2f2; }

    .edit-btn { background-color: #28a745; color:white; border:none; padding:5px 10px; border-radius:5px; margin: 2px; }
    .delete-btn { background-color: #dc3545; color:white; border:none; padding:5px 10px; border-radius:5px; margin: 2px; }
  </style>
</head>
<body>

  <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ -->
  <div id="navbar">
    <div>
      <a href="index.html">ğŸš— Ø§Ù„Ø­Ø¬Ø²</a>
      <a href="dashboard.html">ğŸ“‹ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª</a>
      <a href="settings.html">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</a>
    </div>
    <div>
      ğŸ‘¤ Ù…Ø±Ø­Ø¨Ù‹Ø§ØŒ <span id="usernameDisplay"></span>
      <a href="#" onclick="logout()" style="color:#ffdddd; margin-right:15px;">ğŸšª Ø®Ø±ÙˆØ¬</a>
    </div>
  </div>

  <h2>ğŸ“‹ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h2>

  <div class="search-box">
    <input type="text" id="searchInput" placeholder="ğŸ” Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø£Ùˆ Ø§Ù„Ù…ÙˆÙ‚Ø¹">
    <input type="date" id="dateFilter">
    <button onclick="exportToCSV()">ğŸ“¤ ØªØµØ¯ÙŠØ± CSV</button>
    <button onclick="exportToPDF()">ğŸ“„ ØªØµØ¯ÙŠØ± PDF</button>
  </div>

  <div id="bookingCount"></div>

  <table id="bookingsTable">
    <thead>
      <tr>
        <th>Ø§Ù„Ø§Ø³Ù…</th>
        <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
        <th>Ø§Ù„Ø³ÙŠØ§Ø±Ø©</th>
        <th>Ù…Ù†</th>
        <th>Ø¥Ù„Ù‰</th>
        <th>Ø§Ù„Ù…ÙˆÙ‚Ø¹</th>
        <th>Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…</th>
        <th>Ø§Ù„Ø³Ø¹Ø±</th>
        <th>Ø§Ù„ØªØ­ÙƒÙ…</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    // Ø­Ù…Ø§ÙŠØ© Ø§Ù„ØµÙØ­Ø©
    if (localStorage.getItem("isLoggedIn") !== "true") {
      alert("ğŸ” ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");
      window.location.href = "login.html";
    }

    const username = localStorage.getItem("loggedUser") || "Ù…Ø³ØªØ®Ø¯Ù…";
    document.getElementById("usernameDisplay").textContent = username;

    function logout() {
      localStorage.removeItem("isLoggedIn");
      localStorage.removeItem("loggedUser");
      window.location.href = "login.html";
    }

    // ØªØ­Ù…ÙŠÙ„ ÙˆØ¹Ø±Ø¶ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª
    let bookings = JSON.parse(localStorage.getItem("bookings") || "[]");
    const tbody = document.querySelector("#bookingsTable tbody");
    const searchInput = document.getElementById("searchInput");
    const dateFilter = document.getElementById("dateFilter");
    const bookingCount = document.getElementById("bookingCount");

    function renderTable(data) {
      tbody.innerHTML = "";
      data.forEach((booking, index) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${booking.name}</td>
          <td>${booking.phone}</td>
          <td>${booking.car}</td>
          <td>${booking.start}</td>
          <td>${booking.end}</td>
          <td>${booking.location}</td>
          <td>${booking.duration.replace("Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…: ","")}</td>
          <td>${booking.total.replace("Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ","")}</td>
          <td>
            <button class="edit-btn" onclick="editBooking(${index})">ØªØ¹Ø¯ÙŠÙ„</button>
            <button class="delete-btn" onclick="deleteBooking(${index})">Ø­Ø°Ù</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
      bookingCount.textContent = `ğŸ”¢ Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª: ${data.length}`;
    }

    function filterBookings() {
      const keyword = searchInput.value.toLowerCase();
      const filterDate = dateFilter.value;
      const filtered = bookings.filter(b => {
        const matchesKeyword = b.name.toLowerCase().includes(keyword) || 
                               b.car.toLowerCase().includes(keyword) || 
                               b.location.toLowerCase().includes(keyword);
        const matchesDate = filterDate ? b.start === filterDate || b.end === filterDate : true;
        return matchesKeyword && matchesDate;
      });
      renderTable(filtered);
    }

    function deleteBooking(index) {
      if (confirm("ğŸ—‘ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø­Ø¬Ø²ØŸ")) {
        bookings.splice(index, 1);
        localStorage.setItem("bookings", JSON.stringify(bookings));
        filterBookings();
      }
    }

    function editBooking(index) {
      const data = bookings[index];
      localStorage.setItem("editBooking", JSON.stringify({ ...data, index }));
      window.location.href = "index.html";
    }

    function exportToCSV() {
      const csvRows = [["Ø§Ù„Ø§Ø³Ù…", "Ø§Ù„Ù‡Ø§ØªÙ", "Ø§Ù„Ø³ÙŠØ§Ø±Ø©", "Ù…Ù†", "Ø¥Ù„Ù‰", "Ø§Ù„Ù…ÙˆÙ‚Ø¹", "Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…", "Ø§Ù„Ø³Ø¹Ø±"]];
      bookings.forEach(b => {
        csvRows.push([
          b.name, b.phone, b.car, b.start, b.end,
          b.location,
          b.duration.replace("Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…: ",""),
          b.total.replace("Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ","")
        ]);
      });
      const csvContent = csvRows.map(row => row.join(",")).join("\n");
      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª.csv";
      link.click();
    }

    async function exportToPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({ orientation: "landscape", unit: "pt", format: "a4" });

      doc.setFontSize(16);
      doc.text("ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª", 40, 40);

      const headers = [["Ø§Ù„Ø§Ø³Ù…", "Ø§Ù„Ù‡Ø§ØªÙ", "Ø§Ù„Ø³ÙŠØ§Ø±Ø©", "Ù…Ù†", "Ø¥Ù„Ù‰", "Ø§Ù„Ù…ÙˆÙ‚Ø¹", "Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…", "Ø§Ù„Ø³Ø¹Ø±"]];
      const dataRows = bookings.map(b => [
        b.name, b.phone, b.car, b.start, b.end,
        b.location,
        b.duration.replace("Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…: ",""),
        b.total.replace("Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ","")
      ]);

      const allRows = headers.concat(dataRows);
      let y = 70;
      allRows.forEach((row, i) => {
        let x = 40;
        row.forEach(cell => {
          doc.text(String(cell), x, y);
          x += 100;
        });
        y += 25;
        if (y > 550) {
          doc.addPage();
          y = 40;
        }
      });

      doc.save("Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª.pdf");
    }

    searchInput.addEventListener("input", filterBookings);
    dateFilter.addEventListener("change", filterBookings);

    // Ø¹Ø±Ø¶ Ø£ÙˆÙ„ÙŠ
    renderTable(bookings);
  </script>

</body>
</html>